# ==================== Environment ====================
ENV=development
DEBUG=true
LOG_LEVEL=INFO

# ==================== PostgreSQL Database ====================
# Single database with multiple schemas (auth, books, user_data, recommendations)
DB_HOST=postgres
DB_PORT=5432
DB_NAME=minsik_db
DB_USER=postgres
DB_PASSWORD=postgres

# Connection pooling
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10

# ==================== Redis ====================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=password
REDIS_MAX_CONNECTIONS=20

# ==================== Gateway Service ====================
GATEWAY_HTTP_PORT=8040
GATEWAY_HOST=0.0.0.0
GATEWAY_WORKERS=4

# CORS (only enabled in development, nginx handles it in production)
CORS_ORIGINS=http://localhost:3000
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_ALLOW_HEADERS=*

# gRPC Connection Pool
GRPC_KEEPALIVE_TIME_MS=300000
GRPC_KEEPALIVE_TIMEOUT_MS=10000
GRPC_TIMEOUT=10.0
GRPC_ADMIN_TIMEOUT=60.0

# ==================== Auth Service ====================
AUTH_SERVICE_HOST=auth-service
AUTH_SERVICE_PORT=50051
AUTH_GRPC_PORT=50051

# ==================== Books Service ====================
BOOKS_SERVICE_HOST=books-service
BOOKS_SERVICE_PORT=50055
BOOKS_GRPC_PORT=50055

# Cache TTLs (seconds)
CACHE_BOOK_DETAIL_TTL=3600
CACHE_AUTHOR_DETAIL_TTL=3600
CACHE_AUTHOR_BOOKS_TTL=1800
CACHE_SEARCH_TTL=900
CACHE_POPULAR_TTL=21600

# View count tracking
VIEW_COUNT_FLUSH_INTERVAL=300
VIEW_COUNT_FLUSH_BATCH_SIZE=100

# Search configuration
SEARCH_DEFAULT_LIMIT=10
SEARCH_MAX_LIMIT=100
SEARCH_AUTHOR_BOOKS_EXPANSION=3

# Ranking weights
POPULARITY_WEIGHT=0.3
TEXT_RELEVANCE_WEIGHT=0.7
RECENT_VIEWS_DAYS=7
RECENT_VIEWS_MULTIPLIER=2.0

# ==================== Ingestion Service ====================
INGESTION_SERVICE_HOST=ingestion-service
INGESTION_SERVICE_PORT=50054
INGESTION_GRPC_PORT=50054

# ==================== User Data Service ====================
USER_DATA_SERVICE_HOST=user-data-service
USER_DATA_SERVICE_PORT=50053
USER_DATA_GRPC_PORT=50053

# ==================== Recommendation Service ====================
RECOMMENDATION_SERVICE_HOST=recommendation-service
RECOMMENDATION_SERVICE_PORT=50056
RECOMMENDATION_GRPC_PORT=50056

# ==================== Analytics Service ====================
ANALYTICS_SERVICE_HOST=analytics-service
ANALYTICS_SERVICE_PORT=50058
ANALYTICS_GRPC_PORT=50058

# ==================== External APIs ====================
# Open Library (primary data source)
OPEN_LIBRARY_API_URL=https://openlibrary.org
OPEN_LIBRARY_RATE_LIMIT=100

# Google Books (supplementary data source)
GOOGLE_BOOKS_API_URL=https://www.googleapis.com/books/v1
GOOGLE_BOOKS_API_KEY=

# ==================== Caching ====================
# Service-specific cache TTLs (seconds)
CACHE_TTL_BOOKS=3600
CACHE_TTL_AUTHORS=3600
CACHE_TTL_SEARCH=900
CACHE_TTL_RECOMMENDATIONS=604800

# Emergency cache for circuit breaker (10 minutes)
EMERGENCY_CACHE_TTL=600

# ==================== JWT Authentication ====================
# IMPORTANT: Change JWT_SECRET_KEY in production to a long random string (at least 32 characters)
JWT_SECRET_KEY=
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=15
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30

# ==================== Circuit Breaker ====================
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=30
CIRCUIT_BREAKER_HALF_OPEN_MAX_CALLS=3

# ==================== Timeouts ====================
REDIS_TIMEOUT=1.0
REQUEST_TIMEOUT=30.0

# ==================== Observability ====================
METRICS_ENABLED=true
METRICS_PORT=9090

# ==================== Rate Limiting ====================
# General endpoints (health, public APIs)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_BURST=10

# Admin endpoints (lower limits for sensitive operations)
RATE_LIMIT_ADMIN_PER_MINUTE=20

# ==================== Continuous Ingestion ====================
CONTINUOUS_FETCH_ENABLED=true
CONTINUOUS_OL_INTERVAL_HOURS=1
CONTINUOUS_OL_BOOKS_PER_RUN=100
CONTINUOUS_GB_INTERVAL_HOURS=6
CONTINUOUS_GB_BOOKS_PER_RUN=40

# ==================== Description Enrichment ====================
DESCRIPTION_ENRICH_ENABLED=true
DESCRIPTION_ENRICH_INTERVAL_HOURS=2
DESCRIPTION_ENRICH_BATCH_SIZE=5
DESCRIPTION_MIN_LENGTH=100

# ==================== Open Library Data Dump Import ====================
OL_DUMP_BASE_URL=https://openlibrary.org/data
DUMP_BATCH_SIZE=500
DUMP_TMP_DIR=/tmp
